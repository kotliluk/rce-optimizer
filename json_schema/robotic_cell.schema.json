{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/kotliluk/rce-optimizer/input-schema",

  "title": "Robotic Cell",
  "description": "Robotic Cell Input File for RCE Optimizer",

  "type": "object",
  "properties": {
    "cycle_time": {
      "description": "Maximum cycle time",
      "type": "number"
    },
    "note": {
      "description": "Note (optional)",
      "type": "string"
    },

    "robots": {
      "description": "Description of individual robots",
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "description": "Unique robot identifier",
            "type": "string"
          },
          "note": {
            "description": "Note (optional)",
            "type": "string"
          },
          "position": {
            "description": "Position of robot in cartesian coordinates",
            "$ref": "#/$defs/Position"
          },
          "min_activities_duration": {
            "description": "Minimal possible time of all activities of the robot (sum of durations and min_durations)",
            "type": "number"
          },
          "activities": {
            "description": "Sequence of robot activities",
            "type": "array",
            "minItems": 1,
            "items": {
              "oneOf": [
                {
                  "$ref": "#/$defs/MovementActivity"
                },
                {
                  "$ref": "#/$defs/WorkActivity"
                }
              ]
            }
          }
        },
        "required": [ "id", "position", "min_activities_duration", "activities" ]
      }
    },

    "time_offsets": {
      "description": "Pairs of activities which are relative-time-restricted",
      "type": "array",
      "minItems": 0,
      "items": {
        "type": "object",
        "properties": {
          "a_id": {
            "description": "Id of the first activity",
            "type": "string"
          },
          "b_id": {
            "description": "Id of the second activity",
            "type": "string"
          },
          "min_offset": {
            "description": "Minimal time between activities' start times",
            "type": "number"
          },
          "max_offset": {
            "description": "Maximal time between activities' start times",
            "type": "number"
          }
        },
        "required": [ "a_id", "b_id" ]
      }
    },

    "collisions": {
      "description": "Pairs of colliding activities, i.e. they cannot be executed at once",
      "type": "array",
      "minItems": 0,
      "items": {
        "type": "object",
        "properties": {
          "a_id": {
            "description": "Id of the first activity",
            "type": "string"
          },
          "b_id": {
            "description": "Id of the second activity",
            "type": "string"
          }
        },
        "required": [ "a_id", "b_id" ]
      }
    }
  },

  "required": [ "cycle_time", "robots" ],

  "$defs": {
    "Position": {
      "description": "3D Position",
      "type": "object",
      "properties": {
        "x": {
          "description": "X coordinate",
          "type": "number"
        },
        "y": {
          "description": "Y coordinate",
          "type": "number"
        },
        "z": {
          "description": "Z coordinate",
          "type": "number"
        }
      }
    },

    "MovementActivity": {
      "description": "PTP movement (it is a subject of the optimization)",
      "type": "object",
      "properties": {
        "type": {
          "description": "Activity type",
          "type": "string",
          "pattern": "^MOVEMENT$"
        },
        "id": {
          "description": "Unique identifier among all activities",
          "type": "string"
        },
        "note": {
          "description": "Note (optional)",
          "type": "string"
        },
        "min_duration": {
          "description": "Minimal duration of an activity",
          "type": "number",
          "inclusiveMinimum": 0
        },
        "max_duration": {
          "description": "Maximal duration of an activity",
          "type": "number",
          "inclusiveMinimum": 0
        },
        "start": {
          "description": "Starting position of robot's tool in cartesian coordinates",
          "$ref": "#/$defs/Position"
        },
        "end": {
          "description": "Ending position of robot's tool in cartesian coordinates",
          "$ref": "#/$defs/Position"
        },
        "fixed_start_time": {
          "description": "Fixed start time of the movement (optional)",
          "type": "number",
          "inclusiveMinimum": 0
        },
        "fixed_end_time": {
          "description": "Fixed end time of the movement (optional)",
          "type": "number",
          "inclusiveMinimum": 0
        }
      },
      "required": [ "type", "id", "min_duration", "max_duration", "start", "end" ]
    },

    "WorkActivity": {
      "description": "Work (or another fixed) activity (it is NOT a subject of optimization)",
      "type": "object",
      "properties": {
        "type": {
          "description": "Activity type",
          "type": "string",
          "pattern": "^WORK$"
        },
        "id": {
          "description": "Unique identifier among all activities",
          "type": "string"
        },
        "note": {
          "description": "Note (optional)",
          "type": "string"
        },
        "duration": {
          "description": "Fixed duration of a work activity",
          "type": "number",
          "inclusiveMinimum": 0
        },
        "start": {
          "description": "Starting position of robot's tool in cartesian coordinates",
          "$ref": "#/$defs/Position"
        },
        "end": {
          "description": "Ending position of robot's tool in cartesian coordinates",
          "$ref": "#/$defs/Position"
        },
        "fixed_start_time": {
          "description": "Fixed start time of the movement (optional)",
          "type": "number",
          "inclusiveMinimum": 0
        },
        "fixed_end_time": {
          "description": "Fixed end time of the movement (optional)",
          "type": "number",
          "inclusiveMinimum": 0
        }
      },
      "required": [ "type", "id", "duration", "start", "end" ]
    },

    "IdlingActivity": {
      "description": "Idling possibility in between other activities (it is a subject of the optimization)",
      "type": "object",
      "properties": {
        "type": {
          "description": "Activity type",
          "type": "string",
          "pattern": "^IDLE$"
        },
        "id": {
          "description": "Unique identifier among all activities",
          "type": "string"
        },
        "note": {
          "description": "Note (optional)",
          "type": "string"
        },
        "position": {
          "description": "Position of robot's tool in cartesian coordinates",
          "$ref": "#/$defs/Position"
        }
      },
      "required": [ "type", "id", "position" ]
    }
  }
}
